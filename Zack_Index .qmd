

```{r}
library(ggrepel)
library(broom)
library(GGally)
library(tidyr)
library(dplyr)
library(readr)
library(knitr)
library(kableExtra)

```


Read in the dataset

```{r}
Teammates_stats <- read.csv("data/Teammates_Stats.csv")


```





```{r}

#Need to assign players to one primary team
teammates_clean <- Teammates_stats |>
  mutate(Team = case_when(
    str_detect(Team.s., "Cavs") ~ "Cavs",
    str_detect(Team.s., "Heat") ~ "Heat",
    str_detect(Team.s., "Lakers") ~ "Lakers",
    TRUE ~ Team.s.
  ))

#Standardize PTS and ASTs across the whole dataset
Stats_stdz <- teammates_clean |>
  select(Player, Team, PTS, AST) |>
  mutate(across(c(PTS, AST), 
                ~ (.x - mean(.x)) / sd(.x),
                .names = "{.col}_z")) |>
  select(Player, Team, ends_with("_z"))
```

```{r}
# Iterate through clustering algorithm for 10 different values of k
elbow_plot <- tibble(k = 1:10) |>
  mutate(
    # List-column of 10 kmeans objects 
    # (apply `kmeans()` to each value of `k`)
    kmeans_results = purrr::map(k, ~kmeans(Stats_stdz |> select(PTS_z, AST_z), .x, nstart = 20)),
    # List-column of "glanced" model summaries for each kmeans object
    # (apply `glance()` to each corresponding result after running `kmeans()`)
    glanced = purrr::map(kmeans_results, glance)
  ) |>
  # Turn `glanced` list-column into regular tibble columns
  unnest(cols = c(glanced))

# Construct elbow plot
Elbw_plot <- ggplot(elbow_plot, aes(x = k, y = tot.withinss)) +
  geom_point() + 
  geom_line() +
  scale_x_continuous(breaks = 1:10) +
  labs(x = "Number of clusters (k)", 
       y = "Total within-cluster sum of squares")
Elbw_plot
```

Looks like k = 3 would be the best choice


perform clustering

```{r}
#Perform k-means clustering with k = 3
set.seed(123)
Stats_kmeans3 <- Stats_stdz |> 
  select(PTS_z, AST_z) |>
  kmeans(centers = 3, nstart = 20)

Stats_stdz_c3 <- Stats_stdz |>
  mutate(cluster = as.factor(Stats_kmeans3$cluster))

Stats_kmeans3_summary <- tidy(Stats_kmeans3)
Stats_kmeans3_summary
```


Visualize clustering based on team
```{r}

ggplot(Stats_stdz_c3, aes(x = PTS_z, y = AST_z, color = cluster)) +
  geom_point(size = 3) +
  facet_wrap(~ Team) +
  labs(title = "Clustering of LeBronâ€™s Teammates Based on Teams He Played For",
       x = "Standardized Points per Game (PTS_z)",
       y = "Standardized Assists per Game (AST_z)",
       color = "Cluster") +
  theme_minimal()
```

save plot
```{r}
ggsave("Images/lebron_clusters.png", width = 8, height = 5, dpi = 300)
```



